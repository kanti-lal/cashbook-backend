services:
  - type: web
    name: cashbook-backend
    env: node
    plan: free
    buildCommand: |
      apt-get update && \
      apt-get install -y chromium chromium-common chromium-sandbox ca-certificates \
        fonts-liberation libasound2 libatk-bridge2.0-0 libatk1.0-0 libc6 libcairo2 \
        libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgbm1 libgcc1 libglib2.0-0 \
        libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 \
        libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 \
        libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 lsb-release wget xdg-utils && \
      which chromium && \
      npm ci && \
      npm run build
    startCommand: node dist/index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: DATABASE_FILE
        value: /data/cashlink.db
      - key: PUPPETEER_SKIP_CHROMIUM_DOWNLOAD
        value: "true"
      - key: CHROME_PATH
        value: "/usr/bin/chromium"
    disk:
      name: data
      mountPath: /data
      sizeGB: 1 